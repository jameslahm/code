姓名：王澳

学号：2017010395



### 功能实现情况

- [x] 处理`arp`请求
- [x] 发起`arp`请求
- [x] 处理`arp`回复
- [x] 处理`ip`数据包
- [x] 转发`ip`数据包



### 具体实现说明

- 处理`arp`请求

  判断目标`ip`是否为路由器某一接口`ip`地址，若是，则构造`arp`响应包，回复该接口`mac`地址

- 发起`arp`请求

  在每次周期性检查`ip`与`mac`映射表时，判断是否缓存的`arp`请求次数已超过5次，若未超过，则继续发送`arp`请求包；若已超过5次，则丢弃该请求的未发送包队列，同时给源`ip`地址发送目标不可达的`icmp`消息

- 处理`arp`回复

  首先更新`ip`和`mac`的映射表，同时取出缓存的未发送的包列表，依次发送即可

- 处理`ip`数据包

  判断目标`ip`是否为路由器某一接口`ip`地址，若是，则根据`ip`包头内容，正确处理该数据包，若为`icmp`的`echo`消息，则进行相应的回复，若为不可达的`tcp`、`udp`数据包，则回复目标不可达的`icmp`消息

- 转发`ip`数据包

  首先检查`ip`与`mac`映射表中是否存在有效的映射，若有，则直接更新`TTL`，修改数据包中相应的`mac`，重新计算`checksum`后，根据最长前缀匹配由相应的接口进行转发即可；若不存在有效的映射，则将数据包先放入`arp`的缓存请求列表中，等待收到`arp`响应时，进行处理即可；同时需判断`TTL`更新后是否为0，若为0，则丢弃该数据包，并回复超时的`icmp`消息

  

  

  

